---
author: "Mark Christopher Adkins"
date: '`r paste("Created: 2020-09-12"," Last Modified: ", format(Sys.Date()))`'
title: 'T-Tests'
output:
  html_document:
    toc_float: true
    number_sections: FALSE
    toc: true
    self_contained: true
    css: "scripts/style.css"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r klippy, echo=FALSE, include=TRUE}
klippy::klippy(position = c('top', 'right'))
```

# Independent Samples T-Test

This set of exercises will demonstrate how to verify that the assumptions have been met prior to conducting an independent sample t-test.

To begin, let's load the libraries which will give us access to the functions we will need today.

## Load Libraries

```{r load_libraries, message=FALSE, warning=FALSE}
# Exercises: practice running independent/dependent t-tests

library(pwr)       # power/sample size calcs
library(car)       # leveneTest()
library(psych)     # describeBy()
library(tidyverse) 
library(effsize)   # cohen.d()
```

:::fyi
If you have trouble installing the tidyverse package, you can install/load the individual packages that we need.
```{r eval=FALSE}
library(readr)   # parse_factor()
library(dplyr)   # for easier subsetting and
# data manipulation
library(forcats) # create/mutate factors easier
library(ggplot2) # graphics
```
:::

## Create/Import Data

The next step is to either load some data into R or create some data ourselves. For the exercises within this lab, we will create some data.

```{r create_data}
# create a vector which holds our outcome/dependent variable
# - 16 scores for each group so 16 x 2 = 32 scores
recall <- c(4,5,2,4,6,7,6,6,2,5,4,3,3,3,5,3,
            5,2,4,2,2,3,1,5,3,2,3,3,4,1,5,3)

# create a vector which holds our grouping variable (sometimes called a predictor or factor)
# - 16 subjects per group
group <- c(rep(1,16),
           rep(2,16))

# combine the two vectors into a data.frame
humour <- data.frame(recall,group)
```

Now let's take a peek at our data.

```{r}
# print the data to the console
humour
```

:::fyi
We can take a peek at the data using the `View()` function (Note: `View()` has a capital "V").
```{r eval=FALSE}
# type this into the console pane to see the dataset as a spreadsheet within RStudio
View(humour)
```
:::

## Clean Up the Data {.tabset .tabset-fade .tabset-pills}

Prior to conducting the t-test, we first need to clean up and prepare our data.

One place to start is the variable we created called *group.* Right now, it only has two unique values which designate the group to which each subject belongs.

```{r}
unique(humour$group)
```
:::fyi
If you want to pull a single vector from a data.frame/tibble, you can use the subsetting operator `$`. This can often be useful when a function you are using requires a single vector and not your whole dataset.

You begin by writing the name of the data.frame/tibble, and you follow it by the `$` operator, and then the name of the vector you need.
```{r eval=FALSE}
# extract a the age variable
humour$age
```
:::

But the values 1 and 2 aren't very descriptive. Our next step is to convert this vector of 1's and 2's into a factor, and we should also recode the first level of the factor to "Humourous" and the second level to "Non-humourous".

:::note
When converting a integer vector into a factor, it is usually necessary to first convert it to a character vector (e.g., the value 1 becomes the character "1")
:::

### Puzzle 

:::puzzle
Try to fill in the code to convert the `group` variable into a factor and change the levels of this factor to have more descriptive names.

```{r eval=FALSE}
# convert group to a factor,
# and give the levels better names
humour <- mutate(humour,
                 group = <YOUR CODE HERE>)
```
:::

### Show Solution

:::puzzle
```{r}
# convert group to a factor,
# and give the levels better names
humour <- mutate(humour,
            group = as.character(group),
            group = fct_recode(group,
                        "Humourous" = "1",
                        "Non-humourous" = "2"))
```
:::

## Power

To conduct a power analysis, we will use a function from the *pwr* package. We specify the sample size (*n*), the significance level (*sig.level*), and the effect size (*d*) we want to be able to detect.

```{r}
# conduct the the power of the test to detect an effect size of d = .2
pwr.t.test(n = 16,
           sig.level = .05,
           d = .2)
```

## Check Assumptions

### Normality in **Each** Group

#### QQ-Plots

```{r}
# assess normality using a qqplot
# - for qqplot you need to use an aesthetic called "sample"
ggplot(humour, aes(sample = recall)) +
    geom_qq() +
    geom_qq_line() +
    facet_grid(~group)
```

#### Box Plots

```{r}
# create a box plot to show "recall" distribution for each group
ggplot(humour, aes(x = group, y = recall)) +
    geom_boxplot()
```

#### Using Descriptive Statistics

In past exercises, we have used the `describe()` function to compute descriptive statistics. Today, we will use a related function from the *psych* package called `describeBy()` (note the capital "B"). This will break your data set into groups, and compute descriptive statistics separately for each group.

```{r}
# assess normality using descriptive statistics

describeBy(x = humour$recall,
           group = humour$group,
           digits = 3,
           mat = TRUE)
```

### Homogeneity of Variance

```{r}
# assess homogeneity of variance using leveneTest() function
leveneTest(y = humour$recall,
           group = humour$group,
           center = "mean")

# Using formula notation
leveneTest(y = recall~group,
           data = humour,
           center="mean")
```

## Effect Size

```{r}
# Conduct test and find effect size ---------------------------------------

# compute Cohen's d
cohen.d(d = humour$recall,
        f = humour$group)
```

## Conduct Independent Samples t-test

```{r}
# conduct independent-samples t-test
t.test(formula = recall ~ group,
       data = humour)
```

# Acknowledgements

  * The lovely "DIV TIPS" were made using code from a fantastic blog entry by DesirÃ©e de leon at [https://desiree.rbind.io/post/2019/making-tip-boxes-with-bookdown-and-rmarkdown/](https://desiree.rbind.io/post/2019/making-tip-boxes-with-bookdown-and-rmarkdown/)
  * The copy to clipboard buttons were created using Klippy [https://rlesur.github.io/klippy/reference/klippy.html](https://rlesur.github.io/klippy/reference/klippy.html)

<a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc/4.0/88x31.png" /></a><br />This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/">Creative Commons Attribution-NonCommercial 4.0 International License</a>.
